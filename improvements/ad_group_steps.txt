Step 1: Microsoft Entra ID (Azure AD) App Registration
Before you can use the Graph API, you must register an application in your Azure portal. This will give you the credentials the bot needs to securely access your directory data.

Go to the Azure Portal: https://portal.azure.com/

Navigate to Microsoft Entra ID.

Go to App registrations and click + New registration.

Name it something like OnboardingAutomationBot.

For "Supported account types," choose "Accounts in this organizational directory only".

Click Register.

Note down the Application (client) ID and Directory (tenant) ID. You will need these for your .env file.

Go to Certificates & secrets, click + New client secret, give it a description (e.g., bot_secret), and click Add.

Immediately copy the "Value" of the secret. This is your client secret, and it will not be shown again.

Go to API permissions, click + Add a permission, select Microsoft Graph, and choose Application permissions.

Add the following permissions:

User.Read.All (to read user profiles and managers)

GroupMember.Read.All (to read group memberships)

After adding the permissions, you must click the "Grant admin consent for [Your Organization]" button to approve them.

Step 2: Update Your Database Schema
Now, let's update your configuration table to include the AD group that should be checked for each team.

SQL

-- Add the validation column to your existing configuration table
ALTER TABLE configuration ADD COLUMN IF NOT EXISTS required_ad_group TEXT;

-- Example: Set the required group for your 'CDERS' team
UPDATE configuration
SET required_ad_group = 'CDERS Engineering Team' -- The exact name of the AD group
WHERE config_id = 'CDERS';
Step 3: Update Your Project Dependencies
We need to add the Microsoft Authentication Library (msal) to connect to the Graph API.

File: requirements.txt

Plaintext

psycopg2-binary
schedule
python-dotenv
ollama
msal
requests
Run pip install -r requirements.txt in your activated virtual environment to install it.

Step 4: Update Your .env File
Add the credentials from your Azure App Registration.

Plaintext

# .env.sample

# ... (other settings) ...

# --- Microsoft Graph API (Azure AD) Configuration ---
AZURE_TENANT_ID="your-directory-tenant-id"
AZURE_CLIENT_ID="your-application-client-id"
AZURE_CLIENT_SECRET="your-client-secret-value"
Step 5: Update Your Application Code
